// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

// Expense categories enum
enum ExpenseCategory {
  flights
  accommodation
  food
  transportation
  attractions
  insurance
  shopping
  miscellaneous
}

// User model
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
  
  // Relations
  trips     Trip[]
}

// Trip model
model Trip {
  id               String   @id @default(cuid())
  userId           String
  name             String
  startDate        DateTime
  baseCurrency     String   // ISO 4217 currency code (e.g., "ILS", "USD")
  adults           Int      @default(2)
  children         Int      @default(0)
  travelStyle      String   // e.g., "honeymoon", "family", "post-army", "urban", "other"
  travelStyleOther String?  // Custom style when travelStyle is "other"
  createdAt        DateTime @default(now())
  
  // Relations
  user             User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  expenses         Expense[]
  
  @@index([userId])
  @@index([startDate])
}

// Expense model
model Expense {
  id           String          @id @default(cuid())
  tripId       String
  amount       Decimal         @db.Decimal(12, 2) // Original amount
  currency     String          // ISO 4217 currency code
  amountInBase Decimal         @db.Decimal(12, 2) // Amount converted to trip's base currency
  category     ExpenseCategory
  country      String?         // ISO 3166-1 alpha-2 country code (e.g., "TH", "IL")
  notes        String?         @db.Text
  occurredAt   DateTime        // When the expense occurred
  createdAt    DateTime        @default(now())
  
  // Relations
  trip         Trip            @relation(fields: [tripId], references: [id], onDelete: Cascade)
  
  @@index([tripId])
  @@index([occurredAt])
  @@index([category])
}
